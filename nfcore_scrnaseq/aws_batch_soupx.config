/*
 * nf-core/scrnaseq AWS Batch configuration - soupX variant
 * 
 * This config runs the pipeline with soupX (no CellBender)
 * for faster, cost-effective processing on AWS.
 */

params {
    // Input/Output - S3 paths
    input = 's3://YOUR_BUCKET/inputs/samplesheet.csv'
    outdir = 's3://YOUR_BUCKET/results_soupx'

    // Reference files (can use S3 or iGenomes)
    fasta = 's3://YOUR_BUCKET/references/genome.fa'
    gtf = 's3://YOUR_BUCKET/references/genes.gtf'
    txp2gene = 's3://YOUR_BUCKET/references/splici_fl86_t2g_3col.tsv'

    // Pipeline settings
    aligner = 'alevin'
    protocol = '10XV3'
    simpleaf_rlen = 91

    // Skip CellBender (use soupX instead)
    skip_emptydrops = true

    // Save reference for reuse
    save_reference = true

    // Resource limits
    max_cpus = 16
    max_memory = '64.GB'
    max_time = '12.h'
}

// AWS Batch configuration
process {
    executor = 'awsbatch'
    queue = 'YOUR_CPU_QUEUE'  // Replace with your CPU queue name

    // Default resources
    cpus = 4
    memory = '16.GB'
    time = '4.h'

    // CPU-intensive processes
    withLabel: 'process_high' {
        cpus = 16
        memory = '48.GB'
        time = '6.h'
    }

    withLabel: 'process_medium' {
        cpus = 8
        memory = '32.GB'
        time = '4.h'
    }

    withLabel: 'process_low' {
        cpus = 2
        memory = '8.GB'
        time = '2.h'
    }

    // FastQC
    withName: 'FASTQC' {
        cpus = 8
        memory = '16.GB'
        time = '3.h'
    }

    // Simpleaf
    withName: 'SIMPLEAF_INDEX' {
        cpus = 16
        memory = '48.GB'
        time = '3.h'
    }

    withName: 'SIMPLEAF_QUANT' {
        cpus = 16
        memory = '48.GB'
        time = '2.h'
    }
}

// AWS settings
aws {
    region = 'us-east-1'  // Update to your region
    batch {
        cliPath = '/home/ec2-user/miniconda/bin/aws'
    }
}

// Docker enabled for AWS Batch (required)
docker.enabled = true

// Wave - optional container registry caching
wave {
    enabled = false
}
